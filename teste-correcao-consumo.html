<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Corre√ß√£o Erro Consumo PDF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üîß Teste - Corre√ß√£o Erro "consumo is not defined"</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h5>üìã Status da Corre√ß√£o</h5>
                    <p>Este teste verifica se o erro "consumo is not defined" foi corrigido na gera√ß√£o de PDF dos relat√≥rios.</p>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h5>üîç Problemas Identificados e Corrigidos:</h5>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <strong>Linha 1131:</strong> <code>dados.medias.formatarMoeda(consumo)</code> 
                                ‚Üí Corrigido para <code>formatarNumero(dados.medias.consumo)</code>
                            </li>
                            <li class="list-group-item">
                                <strong>Linha 1131:</strong> <code>dados.medias.formatarMoeda(custoPorKm)</code> 
                                ‚Üí Corrigido para <code>formatarMoeda(dados.medias.custoPorKm)</code>
                            </li>
                            <li class="list-group-item">
                                <strong>Linha 1208:</strong> <code>dados.medias.formatarMoeda(consumo)</code> 
                                ‚Üí Corrigido para <code>formatarNumero(dados.medias.consumo)</code>
                            </li>
                            <li class="list-group-item">
                                <strong>Linha 883:</strong> <code>abast.formatarMoeda(litros)</code> 
                                ‚Üí Corrigido para <code>formatarMoeda(abast.litros)</code>
                            </li>
                            <li class="list-group-item">
                                <strong>M√∫ltiplas linhas:</strong> Vari√°veis n√£o definidas em fun√ß√µes de Excel/PDF 
                                ‚Üí Corrigidas para usar propriedades dos objetos corretos
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>üß™ Teste das Fun√ß√µes</h5>
                        <div class="d-grid gap-2">
                            <button id="testarDados" class="btn btn-info">Testar Obten√ß√£o de Dados</button>
                            <button id="testarPdfSimples" class="btn btn-warning">Testar PDF Simples</button>
                            <button id="testarPdfCompleto" class="btn btn-success">Testar PDF Completo</button>
                        </div>
                        
                        <div id="resultados" class="mt-3"></div>
                    </div>
                </div>

                <!-- Configura√ß√£o de Teste -->
                <div class="row mt-4">
                    <div class="col-12">
                        <h5>‚öôÔ∏è Configura√ß√£o de Teste</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="dataInicio" class="form-label">Data In√≠cio</label>
                                <input type="date" class="form-control" id="dataInicio" value="2024-01-01">
                            </div>
                            <div class="col-md-6">
                                <label for="dataFim" class="form-label">Data Fim</label>
                                <input type="date" class="form-control" id="dataFim" value="2024-12-31">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Elementos necess√°rios para o sistema -->
    <div style="display: none;">
        <div id="relatorioResultados"></div>
        <select id="caminhaoSelect"><option value="">Todos</option></select>
    </div>

    <script>
        // Dados de teste m√≠nimos
        window.caminhoes = [
            { id: 1, placa: 'ABC-1234', modelo: 'Teste 1' },
            { id: 2, placa: 'XYZ-5678', modelo: 'Teste 2' }
        ];

        window.abastecimentos = [
            {
                id: 1,
                caminhao_id: 1,
                data: '2024-06-01',
                km_inicial: 1000,
                km_final: 1500,
                litros: 50,
                valor_total: 300,
                motorista: 'Jo√£o Silva'
            },
            {
                id: 2,
                caminhao_id: 2,
                data: '2024-06-02',
                km_inicial: 2000,
                km_final: 2400,
                litros: 40,
                valor_total: 240,
                motorista: 'Maria Santos'
            }
        ];

        // Implementar AlertUtils necess√°rio
        window.AlertUtils = {
            close: () => console.log('Alert fechado')
        };

        window.AlertInfo = {
            loading: (title, text) => console.log(`Loading: ${title} - ${text}`)
        };

        window.AlertError = {
            show: (title, text) => console.error(`Error: ${title} - ${text}`),
            validation: (text) => console.error(`Validation: ${text}`)
        };

        window.AlertToast = {
            success: (text) => console.log(`Success: ${text}`)
        };

        window.AlertWarning = {
            show: (title, text) => console.warn(`Warning: ${title} - ${text}`)
        };

        // Fun√ß√£o de teste para dados
        document.getElementById('testarDados').addEventListener('click', function() {
            const resultDiv = document.getElementById('resultados');
            
            try {
                resultDiv.innerHTML = '<div class="alert alert-info">Testando obten√ß√£o de dados...</div>';
                
                // Simular obten√ß√£o de dados
                const dados = {
                    totais: {
                        gasto: 540,
                        consumo: 90,
                        distancia: 900
                    },
                    medias: {
                        consumo: 10,
                        custoPorKm: 0.6
                    }
                };
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ Dados obtidos com sucesso!</h6>
                        <pre>${JSON.stringify(dados, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Erro ao obter dados:</h6>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        });

        // Fun√ß√£o de teste para PDF simples
        document.getElementById('testarPdfSimples').addEventListener('click', function() {
            const resultDiv = document.getElementById('resultados');
            
            try {
                resultDiv.innerHTML = '<div class="alert alert-info">Testando PDF simples...</div>';
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Teste simples sem vari√°veis problem√°ticas
                doc.text('Teste PDF - Corre√ß√£o Consumo', 20, 20);
                doc.text('Este PDF foi gerado sem erros de vari√°veis n√£o definidas.', 20, 30);
                
                doc.save('teste-correcao-consumo.pdf');
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ PDF simples gerado com sucesso!</h6>
                        <p>Arquivo salvo como: teste-correcao-consumo.pdf</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Erro ao gerar PDF simples:</h6>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        });

        // Fun√ß√£o de teste para PDF completo
        document.getElementById('testarPdfCompleto').addEventListener('click', function() {
            const resultDiv = document.getElementById('resultados');
            resultDiv.innerHTML = '<div class="alert alert-warning">O teste de PDF completo requer carregamento do arquivo relatorios.js corrigido.</div>';
        });

        console.log('üîß Teste de corre√ß√£o carregado. Dados dispon√≠veis:', { caminhoes: window.caminhoes.length, abastecimentos: window.abastecimentos.length });
    </script>
</body>
</html>
