<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Exportação Excel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2><i class="bi bi-file-earmark-spreadsheet text-success"></i> Teste de Exportação Excel</h2>
                <hr>
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Funções de Exportação</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <i class="bi bi-file-earmark-excel text-success"></i> 
                                            Exportação Excel Básica
                                        </h6>
                                        <p class="card-text">
                                            Relatório Excel com 5 planilhas especializadas:
                                            Dashboard Executivo, Resumo, Dados Detalhados, 
                                            Análise de Custos e Indicadores KPI.
                                        </p>
                                        <button type="button" class="btn btn-success" id="exportarExcel">
                                            <i class="bi bi-download"></i> Excel Básico
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <i class="bi bi-graph-up text-warning"></i> 
                                            Exportação Excel Avançada
                                        </h6>
                                        <p class="card-text">
                                            Relatório Excel com dashboards visuais, 
                                            simulador de cenários, análise preditiva 
                                            e relatório de manutenção preventiva.
                                        </p>
                                        <button type="button" class="btn btn-warning" id="exportarExcelAvancado">
                                            <i class="bi bi-graph-up"></i> Excel Avançado
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h6>Status dos Dados:</h6>
                            <div id="statusDados" class="alert alert-info">
                                Carregando dados...
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <h6>Log de Testes:</h6>
                            <div id="logTestes" class="alert alert-light" style="max-height: 300px; overflow-y: auto;">
                                <small>Aguardando testes...</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Simular dados globais para teste
        window.caminhoes = [
            {
                "placa": "TST-8888",
                "modelo": "Teste Final",
                "ano": 2024,
                "id": "1749118873977lmrpqoo1b"
            }
        ];

        window.abastecimentos = [
            {
                "id": "test1",
                "caminhaoId": "1749118873977lmrpqoo1b",
                "data": "2025-06-01",
                "litros": 50,
                "valorTotal": 300.00,
                "valorLitro": 6.00,
                "odometro": 1000,
                "posto": "Posto Teste 1"
            },
            {
                "id": "test2",
                "caminhaoId": "1749118873977lmrpqoo1b",
                "data": "2025-06-03",
                "litros": 45,
                "valorTotal": 270.00,
                "valorLitro": 6.00,
                "odometro": 1200,
                "posto": "Posto Teste 2"
            },
            {
                "id": "test3",
                "caminhaoId": "1749118873977lmrpqoo1b",
                "data": "2025-06-05",
                "litros": 48,
                "valorTotal": 288.00,
                "valorLitro": 6.00,
                "odometro": 1450,
                "posto": "Posto Teste 3"
            }
        ];

        // Função para log
        function adicionarLog(mensagem, tipo = 'info') {
            const logDiv = document.getElementById('logTestes');
            const hora = new Date().toLocaleTimeString();
            const classe = tipo === 'success' ? 'text-success' : tipo === 'error' ? 'text-danger' : 'text-info';
            logDiv.innerHTML += `<div class="${classe}"><strong>[${hora}]</strong> ${mensagem}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Mostrar status dos dados
        document.addEventListener('DOMContentLoaded', () => {
            const statusDiv = document.getElementById('statusDados');
            const totalCaminhoes = window.caminhoes.length;
            const totalAbastecimentos = window.abastecimentos.length;
            
            statusDiv.innerHTML = `
                <strong>Dados carregados:</strong><br>
                • ${totalCaminhoes} caminhão(ões) cadastrado(s)<br>
                • ${totalAbastecimentos} abastecimento(s) registrado(s)<br>
                • Período: 01/06/2025 a 05/06/2025
            `;
            
            adicionarLog('Dados de teste carregados com sucesso', 'success');
            adicionarLog(`${totalCaminhoes} caminhões e ${totalAbastecimentos} abastecimentos disponíveis`);
        });
    </script>
    
    <!-- Carregar funções de relatório -->
    <script src="src/js/relatorios.js"></script>
    
    <script>
        // Configurar event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Botão Excel Básico
            document.getElementById('exportarExcel').addEventListener('click', () => {
                try {
                    adicionarLog('Iniciando exportação Excel básica...', 'info');
                    exportarRelatorioExcel();
                    adicionarLog('Excel básico exportado com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro na exportação Excel básica:', error);
                    adicionarLog(`Erro na exportação Excel básica: ${error.message}`, 'error');
                }
            });
            
            // Botão Excel Avançado
            document.getElementById('exportarExcelAvancado').addEventListener('click', () => {
                try {
                    adicionarLog('Iniciando exportação Excel avançada...', 'info');
                    exportarRelatorioExcelAvancado();
                    adicionarLog('Excel avançado exportado com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro na exportação Excel avançada:', error);
                    adicionarLog(`Erro na exportação Excel avançada: ${error.message}`, 'error');
                }
            });
            
            adicionarLog('Event listeners configurados', 'success');
        });
    </script>
</body>
</html>
