<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Teste Direto - PDF Completo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            color: #333;
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #4CAF50;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }
        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }
        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ TESTE DIRETO - PDF COMPLETO</h1>
            <p>Teste espec√≠fico da fun√ß√£o exportarPdfCompleto()</p>
        </div>

        <button class="btn btn-primary" onclick="testarPdfCompleto()">
            üìÑ Gerar PDF Completo (9 p√°ginas)
        </button>

        <button class="btn btn-success" onclick="verificarFuncoes()">
            üîç Verificar Fun√ß√µes Dispon√≠veis
        </button>

        <div id="status"></div>
    </div>

    <script src="src/js/relatorios.js"></script>
    <script>
        function exibirStatus(mensagem, tipo = 'info') {
            const statusDiv = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            statusDiv.innerHTML += `<div class="status ${tipo}">[${timestamp}] ${mensagem}</div>`;
        }

        async function testarPdfCompleto() {
            exibirStatus('üöÄ Iniciando teste de PDF completo...', 'info');
            
            try {
                // Verificar se a fun√ß√£o existe
                if (typeof exportarPdfCompleto === 'undefined') {
                    throw new Error('‚ùå Fun√ß√£o exportarPdfCompleto n√£o encontrada!');
                }
                
                exibirStatus('‚úÖ Fun√ß√£o exportarPdfCompleto encontrada', 'success');
                
                // Executar a fun√ß√£o
                exibirStatus('üìä Executando exportarPdfCompleto()...', 'info');
                await exportarPdfCompleto();
                
                exibirStatus('üéâ PDF gerado com sucesso!', 'success');
                
                Swal.fire({
                    icon: 'success',
                    title: 'PDF Gerado!',
                    text: 'O PDF completo de 9 p√°ginas foi criado com sucesso!',
                    confirmButtonText: 'Excelente!'
                });
                
            } catch (error) {
                exibirStatus(`‚ùå ERRO: ${error.message}`, 'error');
                console.error('Erro detalhado:', error);
                
                Swal.fire({
                    icon: 'error',
                    title: 'Erro na Gera√ß√£o',
                    text: error.message,
                    footer: 'Verifique o console (F12) para mais detalhes'
                });
            }
        }

        async function verificarFuncoes() {
            exibirStatus('üîç Verificando fun√ß√µes dispon√≠veis...', 'info');
            
            const funcoes = [
                'exportarPdfCompleto',
                'obterDadosDoRelatorio',
                'criarAnaliseDetalhadaPdf',
                'criarAnaliseCustosPdf',
                'criarIndicadoresPdf',
                'criarAnalisePreditivaPdf',
                'criarDadosDetalhadosPdf',
                'criarSimuladorCenariosPdf',
                'criarManutencaoPreventivaPdf',
                'calcularTotaisGerais',
                'formatDate'
            ];

            let encontradas = 0;
            let detalhes = '';

            funcoes.forEach(nomeFuncao => {
                if (typeof window[nomeFuncao] === 'function') {
                    exibirStatus(`‚úÖ ${nomeFuncao}: Encontrada`, 'success');
                    encontradas++;
                    detalhes += `‚úÖ ${nomeFuncao}\n`;
                } else {
                    exibirStatus(`‚ùå ${nomeFuncao}: N√£o encontrada`, 'error');
                    detalhes += `‚ùå ${nomeFuncao}\n`;
                }
            });

            const resultado = `${encontradas}/${funcoes.length} fun√ß√µes encontradas`;
            exibirStatus(`üìä Resultado: ${resultado}`, encontradas === funcoes.length ? 'success' : 'error');

            Swal.fire({
                icon: encontradas === funcoes.length ? 'success' : 'warning',
                title: 'Verifica√ß√£o de Fun√ß√µes',
                text: resultado,
                html: `<pre style="text-align: left; font-size: 12px;">${detalhes}</pre>`,
                width: 600
            });
        }

        // Verifica√ß√£o autom√°tica ao carregar
        window.addEventListener('load', () => {
            exibirStatus('üéØ P√°gina carregada, verificando ambiente...', 'info');
            
            // Verificar se jsPDF est√° dispon√≠vel
            if (typeof window.jsPDF !== 'undefined') {
                exibirStatus('‚úÖ jsPDF carregado', 'success');
            } else {
                exibirStatus('‚ùå jsPDF n√£o carregado', 'error');
            }
            
            // Verificar se SweetAlert2 est√° dispon√≠vel
            if (typeof Swal !== 'undefined') {
                exibirStatus('‚úÖ SweetAlert2 carregado', 'success');
            } else {
                exibirStatus('‚ùå SweetAlert2 n√£o carregado', 'error');
            }

            setTimeout(verificarFuncoes, 1000);
        });
    </script>
</body>
</html>
