<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API Direto</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f4f4f4; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ Teste API Direto</h1>
    <p>Teste simplificado para verificar conectividade com a API</p>
    
    <!-- Carregar configura√ß√£o -->
    <script src="src/js/env-config.js"></script>
    
    <div>
        <button onclick="testarHealth()">Testar Health</button>
        <button onclick="testarCaminhoes()">Testar Caminh√µes</button>
        <button onclick="testarAbastecimentos()">Testar Abastecimentos</button>
        <button onclick="testarFetch()">Teste Fetch Direto</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        function addResult(title, content, type = 'result') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            document.getElementById('results').appendChild(div);
        }
        
        // Mostrar configura√ß√£o carregada
        setTimeout(() => {
            addResult(
                'Configura√ß√£o Carregada',
                JSON.stringify({
                    ENV_CONFIG: window.ENV_CONFIG,
                    ENV_API_BASE_URL: window.ENV_API_BASE_URL,
                    API_BASE_URL: window.API_BASE_URL,
                    hostname: window.location.hostname
                }, null, 2),
                window.ENV_CONFIG ? 'success' : 'error'
            );
        }, 100);
        
        async function testarFetch() {
            try {
                addResult('Teste Fetch', 'Iniciando teste direto...', 'result');
                
                const url = 'https://controle-combustivel.onrender.com/api/health';
                console.log('Testando URL:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(
                        'Fetch Direto - Sucesso',
                        `Status: ${response.status}\nDados: ${JSON.stringify(data, null, 2)}`,
                        'success'
                    );
                } else {
                    addResult(
                        'Fetch Direto - Erro',
                        `Status: ${response.status}\nStatus Text: ${response.statusText}`,
                        'error'
                    );
                }
            } catch (error) {
                addResult(
                    'Fetch Direto - Erro de Rede',
                    `Erro: ${error.message}\nStack: ${error.stack}`,
                    'error'
                );
            }
        }
        
        async function testarHealth() {
            try {
                addResult('Health Check', 'Verificando sa√∫de da API...', 'result');
                
                if (!window.apiClient) {
                    addResult('Health Check - Erro', 'window.apiClient n√£o est√° dispon√≠vel', 'error');
                    return;
                }
                
                const result = await window.apiClient.health();
                addResult(
                    'Health Check - Sucesso',
                    JSON.stringify(result, null, 2),
                    'success'
                );
            } catch (error) {
                addResult(
                    'Health Check - Erro',
                    `Erro: ${error.message}`,
                    'error'
                );
            }
        }
        
        async function testarCaminhoes() {
            try {
                addResult('Caminh√µes', 'Buscando caminh√µes...', 'result');
                
                if (!window.dbApi) {
                    addResult('Caminh√µes - Erro', 'window.dbApi n√£o est√° dispon√≠vel', 'error');
                    return;
                }
                
                const caminhoes = await window.dbApi.buscarCaminhoes();
                addResult(
                    'Caminh√µes - Sucesso',
                    `Encontrados: ${caminhoes.length} caminh√µes\n${JSON.stringify(caminhoes, null, 2)}`,
                    'success'
                );
            } catch (error) {
                addResult(
                    'Caminh√µes - Erro',
                    `Erro: ${error.message}`,
                    'error'
                );
            }
        }
        
        async function testarAbastecimentos() {
            try {
                addResult('Abastecimentos', 'Buscando abastecimentos...', 'result');
                
                if (!window.dbApi) {
                    addResult('Abastecimentos - Erro', 'window.dbApi n√£o est√° dispon√≠vel', 'error');
                    return;
                }
                
                const abastecimentos = await window.dbApi.buscarAbastecimentos();
                addResult(
                    'Abastecimentos - Sucesso',
                    `Encontrados: ${abastecimentos.length} abastecimentos\n${JSON.stringify(abastecimentos, null, 2)}`,
                    'success'
                );
            } catch (error) {
                addResult(
                    'Abastecimentos - Erro',
                    `Erro: ${error.message}`,
                    'error'
                );
            }
        }
    </script>
    
    <!-- Carregar API ap√≥s configura√ß√£o -->
    <script src="src/js/api.js"></script>
</body>
</html>
