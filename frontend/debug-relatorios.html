<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Relat√≥rios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>üîç Debug - Sistema de Relat√≥rios</h1>
        
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h5>üß™ Teste de Fun√ß√µes de Relat√≥rio</h5>
            </div>
            <div class="card-body">
                <button id="testar-gerarRelatorioConsumo" class="btn btn-primary me-2">Testar gerarRelatorioConsumo()</button>
                <button id="testar-gerarRelatorioCustos" class="btn btn-secondary me-2">Testar gerarRelatorioCustos()</button>
                <button id="testar-exportarPdfCompleto" class="btn btn-danger me-2">Testar exportarPdfCompleto()</button>
            </div>
        </div>
        
        <div class="card mb-3">
            <div class="card-header">
                <h5>üìä Status das Vari√°veis Globais</h5>
            </div>
            <div class="card-body">
                <div id="status-variaveis"></div>
            </div>
        </div>
        
        <div class="card mb-3">
            <div class="card-header">
                <h5>üìã Formul√°rio de Teste</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label for="dataInicio" class="form-label">Data In√≠cio</label>
                        <input type="date" class="form-control" id="dataInicio" value="2025-06-01">
                    </div>
                    <div class="col-md-4">
                        <label for="dataFim" class="form-label">Data Fim</label>
                        <input type="date" class="form-control" id="dataFim" value="2025-06-07">
                    </div>
                    <div class="col-md-4">
                        <label for="caminhaoSelect" class="form-label">Caminh√£o</label>
                        <select class="form-select" id="caminhaoSelect">
                            <option value="todos">Todos os caminh√µes</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>üìù Log de Debug</h5>
            </div>
            <div class="card-body">
                <div id="relatorioResultados" style="min-height: 200px; border: 1px solid #ddd; padding: 10px; background-color: #f8f9fa;">
                    <!-- Resultados dos relat√≥rios aparecer√£o aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock das fun√ß√µes de alerta usando SweetAlert2
        window.AlertInfo = {
            loading: (titulo, msg) => {
                console.log(`Loading: ${titulo} - ${msg}`);
                Swal.fire({
                    title: titulo,
                    text: msg,
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });
            }
        };
        
        window.AlertUtils = {
            close: () => {
                console.log('Alert fechado');
                Swal.close();
            }
        };
        
        window.AlertWarning = {
            show: (titulo, msg) => {
                console.log(`Warning: ${titulo} - ${msg}`);
                Swal.fire({ icon: 'warning', title: titulo, text: msg });
            }
        };
        
        window.AlertToast = {
            success: (msg) => {
                console.log(`Success: ${msg}`);
                Swal.fire({ icon: 'success', title: 'Sucesso', text: msg, timer: 3000 });
            }
        };
        
        window.AlertError = {
            show: (titulo, msg) => {
                console.log(`Error: ${titulo} - ${msg}`);
                Swal.fire({ icon: 'error', title: titulo, text: msg });
            },
            validation: (msg) => {
                console.log(`Validation Error: ${msg}`);
                Swal.fire({ icon: 'error', title: 'Erro de Valida√ß√£o', text: msg });
            }
        };

        // Fun√ß√£o para verificar status das vari√°veis
        function verificarStatus() {
            const statusDiv = document.getElementById('status-variaveis');
            let html = '<div class="row">';
            
            html += '<div class="col-md-6">';
            html += '<h6>üöõ Caminh√µes:</h6>';
            if (typeof window.caminhoes !== 'undefined') {
                html += `<p class="text-success">‚úÖ Carregados: ${window.caminhoes.length} caminh√µes</p>`;
                window.caminhoes.forEach((c, i) => {
                    html += `<small>‚Ä¢ ${c.placa} - ${c.modelo}</small><br>`;
                });
            } else {
                html += '<p class="text-danger">‚ùå Vari√°vel caminhoes n√£o encontrada</p>';
            }
            html += '</div>';
            
            html += '<div class="col-md-6">';
            html += '<h6>‚õΩ Abastecimentos:</h6>';
            if (typeof window.abastecimentos !== 'undefined') {
                html += `<p class="text-success">‚úÖ Carregados: ${window.abastecimentos.length} abastecimentos</p>`;
            } else {
                html += '<p class="text-danger">‚ùå Vari√°vel abastecimentos n√£o encontrada</p>';
            }
            html += '</div>';
            
            html += '</div>';
            
            html += '<h6>üîß Fun√ß√µes Dispon√≠veis:</h6>';
            const funcoes = ['gerarRelatorioConsumo', 'gerarRelatorioCustos', 'exportarPdfCompleto'];
            funcoes.forEach(func => {
                if (typeof window[func] === 'function') {
                    html += `<span class="badge bg-success me-2">‚úÖ ${func}</span>`;
                } else {
                    html += `<span class="badge bg-danger me-2">‚ùå ${func}</span>`;
                }
            });
            
            statusDiv.innerHTML = html;
        }

        // Carregar dados de teste
        window.caminhoes = [
            {"placa": "TST-8888", "modelo": "Scania R450", "ano": 2024, "id": "1"}
        ];
        window.abastecimentos = [
            {"id": "1", "caminhaoId": "1", "data": "2025-06-01", "litros": 50, "valorTotal": 300, "valorLitro": 6, "odometro": 1000, "posto": "Posto Teste"}
        ];
    </script>
    
    <!-- Carregar fun√ß√µes de relat√≥rio -->
    <script src="src/js/relatorios.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            verificarStatus();
            
            // Event listeners para testes
            document.getElementById('testar-gerarRelatorioConsumo').addEventListener('click', () => {
                console.log('üöÄ Testando gerarRelatorioConsumo...');
                try {
                    gerarRelatorioConsumo();
                } catch (error) {
                    console.error('‚ùå Erro:', error);
                    AlertError.show('Erro', error.message);
                }
            });
            
            document.getElementById('testar-gerarRelatorioCustos').addEventListener('click', () => {
                console.log('üöÄ Testando gerarRelatorioCustos...');
                try {
                    gerarRelatorioCustos();
                } catch (error) {
                    console.error('‚ùå Erro:', error);
                    AlertError.show('Erro', error.message);
                }
            });
            
            document.getElementById('testar-exportarPdfCompleto').addEventListener('click', () => {
                console.log('üöÄ Testando exportarPdfCompleto...');
                try {
                    exportarPdfCompleto();
                } catch (error) {
                    console.error('‚ùå Erro:', error);
                    AlertError.show('Erro', error.message);
                }
            });
        });
    </script>
</body>
</html>
