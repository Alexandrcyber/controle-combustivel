<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Espec√≠fico - Gera√ß√£o de Relat√≥rio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>üîç Teste Espec√≠fico - Gera√ß√£o de Relat√≥rio</h1>
        
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                <h5>üß™ Simula√ß√£o Exata da P√°gina Principal</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="dataInicio" class="form-label">Data In√≠cio</label>
                        <input type="date" class="form-control" id="dataInicio" value="2025-06-01">
                    </div>
                    <div class="col-md-6">
                        <label for="dataFim" class="form-label">Data Fim</label>
                        <input type="date" class="form-control" id="dataFim" value="2025-06-07">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="caminhaoSelect" class="form-label">Caminh√£o</label>
                    <select class="form-select" id="caminhaoSelect">
                        <option value="todos">Todos os caminh√µes</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary" id="gerarRelatorio">Gerar Relat√≥rio de Consumo</button>
                <button type="button" class="btn btn-danger ms-2" id="exportarPdfCompleto">Exportar PDF Completo</button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>üìä Resultados do Relat√≥rio</h5>
            </div>
            <div class="card-body">
                <div id="relatorioResultados" style="min-height: 200px; border: 1px solid #ddd; padding: 10px;">
                    <p class="text-center text-muted">Selecione os par√¢metros e gere um relat√≥rio para visualizar os resultados.</p>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5>üìù Console Log</h5>
            </div>
            <div class="card-body">
                <div id="consoleLog" style="background-color: #f8f9fa; padding: 10px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        // Interceptar console.log para mostrar na p√°gina
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('consoleLog');
        
        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logDiv.innerHTML += `<div style="color: ${color}"><strong>[${timestamp}]</strong> ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // Dados de teste similares ao sistema real
        window.caminhoes = [
            {
                "id": "1749118873977lmrpqoo1b",
                "placa": "TST-8888",
                "modelo": "Scania R450",
                "ano": 2024,
                "created_at": "2025-06-01T10:00:00.000Z"
            }
        ];
        
        window.abastecimentos = [
            {
                "id": "test1",
                "caminhao_id": "1749118873977lmrpqoo1b",
                "data": "2025-06-01",
                "litros": 50,
                "valor_total": 300.00,
                "valor_litro": 6.00,
                "odometro": 1000,
                "posto": "Posto Teste 1",
                "created_at": "2025-06-01T10:00:00.000Z"
            },
            {
                "id": "test2",
                "caminhao_id": "1749118873977lmrpqoo1b",
                "data": "2025-06-03",
                "litros": 45,
                "valor_total": 270.00,
                "valor_litro": 6.00,
                "odometro": 1200,
                "posto": "Posto Teste 2",
                "created_at": "2025-06-03T10:00:00.000Z"
            }
        ];
        
        console.log('üìä Dados de teste carregados:', {
            caminhoes: window.caminhoes.length,
            abastecimentos: window.abastecimentos.length
        });
    </script>
    
    <!-- Carregar scripts na mesma ordem do sistema original -->
    <script src="src/js/api.js"></script>
    <script src="src/js/alerts.js"></script>
    <script src="src/js/data.js"></script>
    <script src="src/js/relatorios.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM carregado, configurando event listeners...');
            
            // Verificar se as fun√ß√µes existem
            console.log('üîç Verificando fun√ß√µes dispon√≠veis:');
            console.log('- gerarRelatorioConsumo:', typeof gerarRelatorioConsumo);
            console.log('- exportarPdfCompleto:', typeof exportarPdfCompleto);
            console.log('- AlertError:', typeof AlertError);
            console.log('- AlertInfo:', typeof AlertInfo);
            
            // Event listener para gerar relat√≥rio
            document.getElementById('gerarRelatorio').addEventListener('click', () => {
                console.log('üéØ Bot√£o "Gerar Relat√≥rio" clicado');
                try {
                    gerarRelatorioConsumo();
                } catch (error) {
                    console.error('‚ùå Erro ao gerar relat√≥rio:', error);
                }
            });
            
            // Event listener para PDF completo
            document.getElementById('exportarPdfCompleto').addEventListener('click', () => {
                console.log('üéØ Bot√£o "PDF Completo" clicado');
                try {
                    exportarPdfCompleto();
                } catch (error) {
                    console.error('‚ùå Erro ao exportar PDF:', error);
                }
            });
            
            console.log('‚úÖ Event listeners configurados');
        });
    </script>
</body>
</html>
